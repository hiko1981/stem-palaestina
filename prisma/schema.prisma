generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model VerifiedPhone {
  id         Int      @id @default(autoincrement())
  phoneHash  String   @unique @map("phone_hash")
  verifiedAt DateTime @default(now()) @map("verified_at")

  @@map("verified_phones")
}

model BallotToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique @db.Uuid
  phoneHash String   @map("phone_hash")
  deviceId  String?  @map("device_id")
  used      Boolean  @default(false)
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([phoneHash])
  @@map("ballot_tokens")
}

model Vote {
  id        Int      @id @default(autoincrement())
  phoneHash String   @unique @map("phone_hash")
  voteValue Boolean  @map("vote_value")
  votedAt   DateTime @default(now()) @map("voted_at")

  @@map("votes")
}

model LanguageMiss {
  id       Int      @id @default(autoincrement())
  language String   @unique
  count    Int      @default(1)
  lastSeen DateTime @default(now()) @map("last_seen")

  @@map("language_misses")
}

model Candidate {
  id              Int       @id @default(autoincrement())
  name            String
  party           String
  constituency    String
  contactEmail    String?   @map("contact_email")
  contactPhone    String?   @map("contact_phone")
  phoneHash       String?   @map("phone_hash")
  pledged         Boolean   @default(false)
  publicStatement String?   @map("public_statement")
  verified        Boolean   @default(false)
  optedOut        Boolean   @default(false) @map("opted_out")
  optedOutAt      DateTime? @map("opted_out_at")
  createdAt       DateTime  @default(now()) @map("created_at")

  invitePhones CandidateInvitePhone[]

  @@map("candidates")
}

model PhoneSuppression {
  id        Int      @id @default(autoincrement())
  phoneHash String   @unique @map("phone_hash")
  scope     String   @default("all")
  reason    String   @default("user_request")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("phone_suppressions")
}

model CandidateInvitePhone {
  id          Int       @id @default(autoincrement())
  candidateId Int       @map("candidate_id")
  phoneHash   String    @map("phone_hash")
  createdAt   DateTime  @default(now()) @map("created_at")

  candidate Candidate @relation(fields: [candidateId], references: [id])

  @@unique([candidateId, phoneHash])
  @@map("candidate_invite_phones")
}

model DeviceParticipation {
  id        Int      @id @default(autoincrement())
  deviceId  String   @unique @map("device_id")
  phoneHash String   @map("phone_hash")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("device_participations")
}

model SupportMessage {
  id        Int      @id @default(autoincrement())
  category  String
  message   String
  deviceId  String?  @map("device_id")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("support_messages")
}

model PageView {
  id    Int      @id @default(autoincrement())
  page  String   @default("/")
  date  DateTime @db.Date
  count Int      @default(1)

  @@unique([page, date], name: "page_date")
  @@map("page_views")
}
